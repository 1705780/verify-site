# Full spec for this file is here:
# https://git.corp.adobe.com/proteus-platform/moonbeam-translator/blob/master/pipeline_spec.yml
services:
  - product: cai
    name: verify-site
    repository:
      name: verify-site
      owner: cai
      multi_merge_allowed: false
      min_approvers: 1
    service_secrets:
      - name: moonbeam_token
        github_token: true
        secret_data:
          field: moonbeam_token
          path: dme_cai/caivrfy
      - name: ssh_private_key
        global: "true"
        secret_data:
          field: ssh_private_key
          path: dme_cai/caivrfy
      - name: artifactory_corp_credentials
        global: "true"
        secret_data:
          field: artifactory_corp_credentials
          path: dme_cai/caivrfy
      - name: Tessa_API_Key
        secret_data:
          field: tessa2_api_key
          path: dme_cai/caivrfy
      - name: PUBLIC_GITHUB_PACKAGE_TOKEN
        global: 'true'
        secret_data:
          field: public_github_package_token
          path: dme_cai/caivrfy
    environments:
      - name: Build
        tier: 4
        production: false
        auto_promote: false
        optional: false
        single_rollback_allowed: false
        environment_stages:
          - name: default
        projects:
          - title: CAI Verify Site Build
            name: client-cai-verify-site-makefile-exec
            project_group: cai-build
            build_type: lambda
            lambda: proteus
            stage: default
            build_on_rollback: false
            deploy_token: false
            deployed_sha_for_rollback: false
            required: true
            unstable_allowed: false
            build_params:
              - name: TYPE
                param_type: string
                default: static-content
                hidden: false
              - name: ACTION
                param_type: string
                default: build
                hidden: false
              - name: PATH_PREFIX
                param_type: string
                default: verify-site
                hidden: false
              - name: SERVICE_NAME
                param_type: string
                default: verify-site
                hidden: false
              - name: enableTessaAnalysis
                param_type: string
                default: "true"
                hidden: false
              - name: pushPageObjects
                param_type: string
                default: "true"
                hidden: false
              - name: ARTIFACTORY_DOCKER_REGISTRY
                param_type: string
                default: docker-cai-verify-site-release.dr.corp.adobe.com
                hidden: false
              - name: DOCKER_REPO
                param_type: string
                default: docker-cai-verify-site-release
                hidden: false
      - name: Dev
        tier: 3
        production: false
        auto_promote: false
        optional: false
        single_rollback_allowed: false
        environment_stages:
          - name: deploy---Dev
        projects:
          - title: CAI Verify Site dev deploy
            name: client-cai-verify-site-makefile-exec
            project_group: cai-dev
            build_type: lambda
            lambda: proteus
            stage: deploy---Dev
            build_on_rollback: true
            deploy_token: false
            deployed_sha_for_rollback: false
            required: true
            unstable_allowed: false
            build_params:
              - name: TYPE
                param_type: string
                default: static-content
                hidden: false
              - name: ACTION
                param_type: string
                default: deploy
                hidden: false
              - name: SERVICE_NAME
                param_type: string
                default: verify-site
                hidden: false
              - name: SUPPORT_ROLLBACK_CLEANUP
                param_type: string
                default: "true"
                hidden: false
              - name: ENVIRONMENT_NAME
                param_type: string
                default: dev
                hidden: false
              - name: clientIAMRole
                param_type: string
                default: arn:aws:iam::503556268241:role/VerifySiteDeployerIAMRole
                hidden: false
              - name: ARTIFACTORY_DOCKER_REGISTRY
                param_type: string
                default: docker-cai-verify-site-release.dr.corp.adobe.com
                hidden: false
              - name: DOCKER_REPO
                param_type: string
                default: docker-cai-verify-site-release
                hidden: false
              - name: S3_BUCKETS
                param_type: string
                default: adobe-cai-verify-dev
                hidden: false
      - name: Stage
        tier: 2
        production: false
        auto_promote: false
        optional: false
        single_rollback_allowed: false
        environment_stages:
          - name: deploy---Stage
        projects:
          - title: CAI Verify Site Stage Deploy
            name: client-cai-verify-site-makefile-exec
            project_group: cai-stage
            build_type: lambda
            lambda: proteus
            stage: deploy---Stage
            build_on_rollback: true
            deploy_token: false
            deployed_sha_for_rollback: false
            required: true
            unstable_allowed: false
            build_params:
              - name: TYPE
                param_type: string
                default: static-content
                hidden: false
              - name: ACTION
                param_type: string
                default: deploy
                hidden: false
              - name: SERVICE_NAME
                param_type: string
                default: verify-site
                hidden: false
              - name: SUPPORT_ROLLBACK_CLEANUP
                param_type: string
                default: "true"
                hidden: false
              - name: ENVIRONMENT_NAME
                param_type: string
                default: stage
                hidden: false
              - name: clientIAMRole
                param_type: string
                default: arn:aws:iam::351073470682:role/VerifySiteDeployerIAMRole
                hidden: false
              - name: ARTIFACTORY_DOCKER_REGISTRY
                param_type: string
                default: docker-cai-verify-site-release.dr.corp.adobe.com
                hidden: false
              - name: DOCKER_REPO
                param_type: string
                default: docker-cai-verify-site-release
                hidden: false
              - name: S3_BUCKETS
                param_type: string
                default: adobe-cai-verify-stage
                hidden: false
      - name: Prod
        tier: 1
        production: true
        auto_promote: false
        optional: false
        single_rollback_allowed: false
        environment_stages:
          - name: deploy---Prod
        projects:
          - title: CAI Verify Site Prod Deploy
            name: client-cai-verify-site-makefile-exec
            project_group: cai-prod
            build_type: lambda
            lambda: proteus
            stage: deploy---Prod
            build_on_rollback: true
            deploy_token: false
            deployed_sha_for_rollback: false
            required: true
            unstable_allowed: false
            build_params:
              - name: TYPE
                param_type: string
                default: static-content
                hidden: false
              - name: ACTION
                param_type: string
                default: deploy
                hidden: false
              - name: SERVICE_NAME
                param_type: string
                default: verify-site
                hidden: false
              - name: SUPPORT_ROLLBACK_CLEANUP
                param_type: string
                default: "true"
                hidden: false
              - name: ENVIRONMENT_NAME
                param_type: string
                default: prod
                hidden: false
              - name: clientIAMRole
                param_type: string
                default: arn:aws:iam::905754061388:role/VerifySiteDeployerIAMRole
                hidden: false
              - name: ARTIFACTORY_DOCKER_REGISTRY
                param_type: string
                default: docker-cai-verify-site-release.dr.corp.adobe.com
                hidden: false
              - name: DOCKER_REPO
                param_type: string
                default: docker-cai-verify-site-release
                hidden: false
              - name: S3_BUCKETS
                param_type: string
                default: adobe-cai-verify-prod
                hidden: false
